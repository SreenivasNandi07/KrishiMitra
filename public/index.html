<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriMind AI | Smart Farm Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .accent-gradient { background: linear-gradient(135deg, #4ade80 0%, #2dd4bf 100%); }
    </style>
</head>
<body class="p-8">
    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-12">
            <div>
                <h1 class="text-4xl font-bold tracking-tight">AgriMind <span class="text-green-400">AI</span></h1>
                <p class="text-slate-400 mt-2">Specialist-driven insights for your crops.</p>
            </div>
            <div class="glass px-6 py-2 rounded-full text-sm font-medium">Status: <span class="text-green-400">‚óè Connected</span></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1">
                <div class="glass p-6 rounded-3xl h-full">
                    <h3 class="text-xl font-semibold mb-4">Ask Your Specialist</h3>
                    <textarea id="userInput" class="w-full h-40 bg-transparent border border-slate-700 rounded-2xl p-4 focus:ring-2 focus:ring-green-400 outline-none transition-all" placeholder="Try asking: What's the best strategy for Wheat in Rajkot?"></textarea>
                    <button onclick="askAI()" class="accent-gradient w-full py-4 rounded-2xl font-bold text-slate-900 mt-4 hover:scale-105 transition-transform">Get Prediction</button>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div id="aiOutput" class="glass p-8 rounded-3xl min-h-[400px] flex flex-col justify-center border-l-4 border-l-green-400">
                    <div id="placeholderText" class="text-center opacity-30">
                        <p class="text-5xl mb-4">üå±</p>
                        <p>Waiting for your crop details...</p>
                    </div>
                    <div id="loading" class="hidden text-center animate-pulse">Analyzing market data and training LSTM...</div>
                    <div id="actualResult" class="hidden prose prose-invert max-w-none leading-relaxed"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function askAI() {
            const query = document.getElementById('userInput').value;
            const output = document.getElementById('actualResult');
            const placeholder = document.getElementById('placeholderText');
            const loading = document.getElementById('loading');

            placeholder.classList.add('hidden');
            loading.classList.remove('hidden');
            output.classList.add('hidden');

            const res = await fetch('/ask-ai', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ query })
            });
            const data = await res.json();

            loading.classList.add('hidden');
            output.classList.remove('hidden');
            output.innerHTML = data.answer.replace(/\n/g, '<br>');
        }
    </script>
</body>
</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriMind AI - Command Center</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        body { 
            background: radial-gradient(circle at top left, #1a2e1a, #050505); 
            color: white; 
        }
        /* Custom scrollbar for the chat */
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 10px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-black/50 border-r border-white/10 p-6 flex flex-col">
        <div class="flex items-center gap-3 mb-10">
            <span class="text-3xl">üåæ</span>
            <h1 class="text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-500 bg-clip-text text-transparent">
                AgriMind AI
            </h1>
        </div>
        
        <nav class="flex-1 space-y-2">
            <button onclick="focusInput()" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/10 transition text-gray-400 hover:text-white">
                <span>ü§ñ</span> AI Assistant
            </button>
            <button class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/10 transition text-gray-400 hover:text-white">
                <span>üìà</span> Price Predictor
            </button>
            <button class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/10 transition text-gray-400 hover:text-white">
                <span>üè¨</span> Best Mandi
            </button>
            <button class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/10 transition text-gray-400 hover:text-white">
                <span>üì¶</span> Storage Advisor
            </button>
        </nav>

        <div class="mt-auto p-4 glass rounded-2xl text-xs text-gray-500 text-center">
            Ollama Llama 3.1 & LSTM Engine
        </div>
    </aside>

    <main class="flex-1 p-8 overflow-y-auto">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass p-6 rounded-2xl">
                <p class="text-gray-400 text-sm">Target Crop</p>
                <select id="crop-select" class="bg-transparent text-2xl font-bold text-white outline-none mt-1">
                    <option value="Wheat" class="bg-gray-900">Wheat</option>
                    <option value="Rice" class="bg-gray-900">Rice</option>
                    <option value="Cotton" class="bg-gray-900">Cotton</option>
                </select>
            </div>
            <div id="mandi-card" class="glass p-6 rounded-2xl border-l-4 border-blue-500">
                <p class="text-gray-400 text-sm">Best Mandi</p>
                <h3 id="best-mandi-text" class="text-2xl font-bold">---</h3>
            </div>
            <div class="glass p-6 rounded-2xl border-l-4 border-orange-500">
                <p class="text-gray-400 text-sm">Storage Signal</p>
                <h3 id="storage-signal" class="text-2xl font-bold">Waiting...</h3>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <div class="glass p-6 rounded-3xl flex flex-col h-[550px]">
                <h3 class="font-bold mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    AI Insights
                </h3>
                <div id="chat-box" class="flex-1 overflow-y-auto space-y-4 pr-2">
                    <div class="bg-white/5 p-4 rounded-2xl text-gray-300">
                        Namaste! Select a crop and ask me anything about the market.
                    </div>
                </div>
                <div class="mt-4 relative">
                    <input id="user-input" type="text" placeholder="Type your question..." 
                           class="w-full p-4 bg-white/5 border border-white/10 rounded-2xl outline-none focus:border-green-500 transition">
                    <button onclick="runAnalysis()" 
                            class="absolute right-2 top-2 bottom-2 bg-green-500 hover:bg-green-600 px-6 rounded-xl font-bold transition">
                        Analyze
                    </button>
                </div>
            </div>

            <div class="glass p-6 rounded-3xl flex flex-col h-[550px]">
                <h3 class="font-bold mb-4 text-gray-400 uppercase text-sm tracking-wider">LSTM 7-Day Forecast</h3>
                <div class="flex-1 flex items-center justify-center">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

        </div>
    </main>

    <script>
        let chart;

        function focusInput() {
            document.getElementById('user-input').focus();
        }

        async function runAnalysis() {
            const crop = document.getElementById('crop-select').value;
            const query = document.getElementById('user-input').value;
            const chatBox = document.getElementById('chat-box');

            if (!query) return;

            // 1. Clear and Show Loading
            chatBox.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-green-600/20 p-3 rounded-2xl max-w-[80%]">${query}</div>
                </div>
                <div id="loading-spinner" class="text-green-400 animate-pulse text-sm">
                    Searching Mandi data & running LSTM math...
                </div>
            `;
            chatBox.scrollTop = chatBox.scrollHeight;

            // --- ASYNCHRONOUS LOADING (FAST DATA) ---

            // A. Prediction Chart
            fetch('/predict-price', {
                method: 'POST', 
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({crop, query})
            })
            .then(res => res.json())
            .then(data => updateChart(data.prediction));

            // B. Mandi Stats
            fetch('/best-mandi', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({crop, query})
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('best-mandi-text').innerText = data.mandi.mandi || "N/A";
                document.getElementById('storage-signal').innerText = "CALCULATING...";
            });

            // --- SLOW DATA (LLM) ---
            try {
                // Inside index.html script
                const response = await fetch('/ask-ai', {
                     method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                    query: query, // This must match the 'query' key in Python
                    crop: crop    // This must match the 'crop' key in Python
                    })
                });
                const data = await response.json();
                
                document.getElementById('loading-spinner').remove();
                chatBox.innerHTML += `
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5 leading-relaxed">
                        ${data.answer.replace(/\n/g, '<br>')}
                    </div>
                `;
                // Simple logic for signal based on text
                if (data.answer.includes("SELL")) document.getElementById('storage-signal').innerText = "SELL NOW";
                else document.getElementById('storage-signal').innerText = "STORE";
                
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                document.getElementById('loading-spinner').innerText = "Connection lost.";
            }
        }

        function updateChart(prices) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                    datasets: [{
                        label: 'Predicted Price (‚Çπ)',
                        data: prices,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#22c55e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#9ca3af' } },
                        x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>